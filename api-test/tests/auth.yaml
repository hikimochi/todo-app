desc: auth
runners:
  req: ${API_TEST_BASEURL}
vars:
  email: ${API_TEST_EMAIL}
  password: ${API_TEST_PASSWORD}
  csrfToken: 41a104ea5264c68ed1b0d74e5502aad65c382d571f621e978125c4e24e4a8573
  callbackUrl: https://todo-app-qajp.vercel.app/login?from=%2Ftodo
  redirect: false
  json: true

steps:
  auth:
    desc: "email/passwordでログインをする"
    req:
      /api/auth/callback/credentials:
        post:
          headers:
            Accept: '*/*'
            Accept-Language: ja
            Cookie: __Host-next-auth.csrf-token=41a104ea5264c68ed1b0d74e5502aad65c382d571f621e978125c4e24e4a8573%7C89b2b12351b5e2599d6a02811a2f529f2139e61f99499b14ac515dccc092c52e;
              __Secure-next-auth.callback-url=https%3A%2F%2Ftodo-app-qajp.vercel.app%2F
            Origin: https://todo-app-qajp.vercel.app
            Priority: u=1, i
            Referer: https://todo-app-qajp.vercel.app/login?callbackUrl=https%3A%2F%2Ftodo-app-qajp.vercel.app%2F
          body:
            application/x-www-form-urlencoded:
              email: "{{ vars.email }}"
              password: "{{ vars.password }}"
              csrfToken: "{{ vars.csrfToken }}"
              returnSecureToken: "{{ vars.redirect }}"
              callbackUrl: "{{ vars.callbackUrl }}"
              json: "{{ vars.json }}"
    # test: steps.auth.res.headers['Set-Cookie'][1] == 'hoge'
  create:
    desc: todoの作成
    req:
      /todo:
        post:
          headers:
            Cookie: __Host-next-auth.csrf-token=019c78405c972ab9438fe737770023ceba5f589253fb525d03937744f92c6fe2%7Cb688d1108185cbecdc3df324852cc05a573378492f09683634744dce8981daf3;
              __Secure-next-auth.callback-url=https%3A%2F%2Ftodo-app-qajp.vercel.app%2Flogin%3Ffrom%3D%252Ftodo;
              __Secure-next-auth.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..zdOgNoGZ943T-LC0.4dF2Ec1j4orw_b0ZPTVOBHeAInvREhdGaiMxvsLDo8qjYsn_ml7-OiMUqrhjjmtRsSDhHQta15urRtmgX5MHj67WatDHeU6lHwlcGGvlxPdOWWdmjyJ2LaaqbFdFLW34vVjoSQP92upgo2BRYG5jbHq409oCiAn76YcytdBOx0lQmZ12cOv1bN2XObt9p3qbUNp5zq8ZH0shapJZGaLoq3crM9nPVPJGKk3j-myFaTQVDTeb5iTEPnvE63I8X7LrV47SLmSn6wyef_a0TCdCj0DQToWd9nEkU0NhBOz8Hz9W40PJXsjFtxfUjA.-6ny2wwcbow9eVhTq8Nemw
          body:
            application/json:
              - title: "TODOの作成"
                description: ""
                dueDate: "$undefined"
                status: "ACTIVE"
                userId: "clyzwvwaa0000ucm5lmdli153"
    test: steps.create.res.status == 200
